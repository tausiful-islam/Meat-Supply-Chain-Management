<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Browse Products - MeatChain Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="../assests/Style/style.css">
</head>
<body style="background-color: #f8f9fa;">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand fw-bold" href="#" id="brandLink"><i class="bi bi-truck me-2"></i>MeatChain Pro</a>
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav me-auto">
      <li class="nav-item"><a class="nav-link" href="customer_dashboard.html">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link active" href="inventory_view.html">Browse Products</a></li>
      <li class="nav-item"><a class="nav-link" href="orders.html">My Orders</a></li>
    </ul>
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="login.html"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container-fluid mt-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-info fw-bold mb-0"><i class="bi bi-eye me-2"></i>Browse Products</h2>
      <p class="text-muted mb-0">Fresh meat products available for order</p>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filters">
    <div class="row">
      <div class="col-md-4">
        <div class="input-group">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
        </div>
      </div>
      <div class="col-md-3">
        <select id="categoryFilter" class="form-select">
          <option value="">All Categories</option>
          <option value="Beef">Beef</option>
          <option value="Pork">Pork</option>
          <option value="Chicken">Chicken</option>
          <option value="Lamb">Lamb</option>
          <option value="Fish">Fish</option>
          <option value="Processed">Processed</option>
        </select>
      </div>
      <div class="col-md-3">
        <select id="statusFilter" class="form-select">
          <option value="">All Products</option>
          <option value="Fresh">Fresh Only</option>
        </select>
      </div>
      <div class="col-md-2">
        <button class="btn btn-outline-info w-100" onclick="clearFilters()">
          <i class="bi bi-arrow-clockwise me-1"></i>Clear
        </button>
      </div>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="row" id="productsGrid">
    <!-- Products will be loaded here -->
  </div>
</div>

<!-- Order Modal -->
<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="orderModalLabel">
          <i class="bi bi-cart-plus me-2"></i>Add to Order
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <i class="bi bi-box display-4 text-success mb-3"></i>
          <h5 id="productName">Product Name</h5>
          <p class="text-muted" id="productDetails">Details</p>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">Available Quantity</label>
            <input type="text" id="availableQty" class="form-control" readonly>
          </div>
          <div class="col-md-6 mb-3">
            <label class="form-label">Unit Price</label>
            <input type="text" id="unitPrice" class="form-control" readonly>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">Quantity to Order (kg)</label>
          <input type="number" id="orderQuantity" class="form-control" step="0.1" min="0.1" placeholder="Enter quantity">
        </div>
        <div class="mb-3">
          <label class="form-label">Total Price</label>
          <input type="text" id="totalPrice" class="form-control" readonly>
        </div>
        <input type="hidden" id="selectedProductId">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" onclick="addToCart()">
          <i class="bi bi-cart-plus me-1"></i>Add to Cart
        </button>
      </div>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>

const inventory = [
    {
        id: 'MT001',
        name: 'Premium Beef Ribeye',
        category: 'Beef',
        supplier: 'ABC Farms',
        quantity: 25.5,
        unitPrice: 35.99,
        expiryDate: '2025-08-15',
        status: 'Fresh',
        description: 'Premium quality ribeye steak from grass-fed cattle'
    },
    {
        id: 'MT002',
        name: 'Chicken Breast',
        category: 'Chicken',
        supplier: 'Poultry Plus',
        quantity: 45.0,
        unitPrice: 12.99,
        expiryDate: '2025-08-05',
        status: 'Fresh',
        description: 'Fresh, boneless chicken breast from free-range chickens'
    },
    {
        id: 'MT003',
        name: 'Fresh Salmon Fillet',
        category: 'Fish',
        supplier: 'Ocean Fresh',
        quantity: 15.2,
        unitPrice: 28.50,
        expiryDate: '2025-08-03',
        status: 'Fresh',
        description: 'Atlantic salmon fillet, wild-caught and fresh'
    },
    {
        id: 'MT004',
        name: 'Pork Tenderloin',
        category: 'Pork',
        supplier: 'Farm Direct',
        quantity: 30.8,
        unitPrice: 18.75,
        expiryDate: '2025-08-20',
        status: 'Fresh',
        description: 'Tender pork tenderloin from farm-raised pigs'
    },
    {
        id: 'MT005',
        name: 'Lamb Chops',
        category: 'Lamb',
        supplier: 'Mountain Ranch',
        quantity: 12.3,
        unitPrice: 42.00,
        expiryDate: '2025-08-10',
        status: 'Fresh',
        description: 'Premium lamb chops from grass-fed lambs'
    },
    {
        id: 'MT006',
        name: 'Ground Beef',
        category: 'Beef',
        supplier: 'ABC Farms',
        quantity: 50.0,
        unitPrice: 8.99,
        expiryDate: '2025-08-08',
        status: 'Fresh',
        description: '85% lean ground beef, perfect for burgers and meatballs'
    }
];

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    setupBrandNavigation();
    loadProductsGrid();
    setupEventListeners();
});

// Setup brand navigation based on user login status
function setupBrandNavigation() {
    const user = JSON.parse(localStorage.getItem('loggedInUser'));
    const brandLink = document.getElementById('brandLink');
    
    if (user) {
        // User is logged in, redirect to appropriate dashboard
        if (user.role === 'admin') {
            brandLink.href = 'admin_dashboard.html';
        } else if (user.role === 'customer') {
            brandLink.href = 'customer_dashboard.html';
        }
    } else {
        // User is not logged in, redirect to home page
        brandLink.href = '../index.html';
    }
}

// Load products grid
function loadProductsGrid() {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';
    
    const freshProducts = inventory.filter(item => item.status === 'Fresh');
    
    freshProducts.forEach(product => {
        const productCard = createProductCard(product);
        grid.appendChild(productCard);
    });
}

// Create product card
function createProductCard(product) {
    const col = document.createElement('div');
    col.className = 'col-lg-4 col-md-6 mb-4';
    
    const daysUntilExpiry = Math.ceil((new Date(product.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
    const urgencyClass = daysUntilExpiry <= 3 ? 'border-warning' : 'border-success';
    
    col.innerHTML = `
        <div class="card h-100 ${urgencyClass} shadow-sm">
            <div class="card-body">
                <div class="text-center mb-3">
                    <i class="bi bi-box display-4 text-primary mb-2"></i>
                    <h5 class="card-title">${product.name}</h5>
                    <span class="badge bg-secondary mb-2">${product.category}</span>
                </div>
                <p class="card-text text-muted small">${product.description}</p>
                <div class="row text-center">
                    <div class="col-6">
                        <small class="text-muted">Price</small>
                        <div class="fw-bold text-success">$${product.unitPrice}/kg</div>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">Available</small>
                        <div class="fw-bold text-info">${product.quantity}kg</div>
                    </div>
                </div>
                <div class="text-center mt-2">
                    <small class="text-muted">Expires: ${formatDate(product.expiryDate)}</small>
                    ${daysUntilExpiry <= 3 ? '<div class="text-warning small"><i class="bi bi-exclamation-triangle"></i> Expires soon!</div>' : ''}
                </div>
            </div>
            <div class="card-footer bg-transparent text-center">
                <button class="btn btn-success w-100" onclick="openOrderModal('${product.id}')">
                    <i class="bi bi-cart-plus me-1"></i>Order Now
                </button>
            </div>
        </div>
    `;
    
    return col;
}

// Format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
    });
}

// Open order modal
function openOrderModal(productId) {
    const product = inventory.find(p => p.id === productId);
    if (!product) return;
    
    document.getElementById('productName').textContent = product.name;
    document.getElementById('productDetails').textContent = `${product.category} - ${product.description}`;
    document.getElementById('availableQty').value = product.quantity + ' kg';
    document.getElementById('unitPrice').value = '$' + product.unitPrice + '/kg';
    document.getElementById('selectedProductId').value = product.id;
    document.getElementById('orderQuantity').value = '';
    document.getElementById('totalPrice').value = '$0.00';
    
    const modal = new bootstrap.Modal(document.getElementById('orderModal'));
    modal.show();
}

// Setup event listeners
function setupEventListeners() {
    // Search functionality
    document.getElementById('searchInput').addEventListener('input', filterProducts);
    document.getElementById('categoryFilter').addEventListener('change', filterProducts);
    document.getElementById('statusFilter').addEventListener('change', filterProducts);
    
    // Order quantity change
    document.getElementById('orderQuantity').addEventListener('input', calculateTotal);
}

// Calculate total price
function calculateTotal() {
    const productId = document.getElementById('selectedProductId').value;
    const product = inventory.find(p => p.id === productId);
    const quantity = parseFloat(document.getElementById('orderQuantity').value) || 0;
    
    if (product && quantity > 0) {
        const total = quantity * product.unitPrice;
        document.getElementById('totalPrice').value = '$' + total.toFixed(2);
    } else {
        document.getElementById('totalPrice').value = '$0.00';
    }
}

// Add to cart
function addToCart() {
    const productId = document.getElementById('selectedProductId').value;
    const quantity = parseFloat(document.getElementById('orderQuantity').value);
    const product = inventory.find(p => p.id === productId);
    
    if (!product || !quantity || quantity <= 0) {
        alert('Please enter a valid quantity');
        return;
    }
    
    if (quantity > product.quantity) {
        alert('Requested quantity exceeds available stock');
        return;
    }
    
    // Get existing cart or create new one
    let cart = JSON.parse(localStorage.getItem('customerCart')) || [];
    
    // Check if product already in cart
    const existingItem = cart.find(item => item.productId === productId);
    
    if (existingItem) {
        existingItem.quantity += quantity;
        existingItem.total = existingItem.quantity * product.unitPrice;
    } else {
        cart.push({
            productId: productId,
            productName: product.name,
            category: product.category,
            unitPrice: product.unitPrice,
            quantity: quantity,
            total: quantity * product.unitPrice
        });
    }
    
    localStorage.setItem('customerCart', JSON.stringify(cart));
    
    // Close modal and show success message
    const modal = bootstrap.Modal.getInstance(document.getElementById('orderModal'));
    modal.hide();
    
    showNotification(`${product.name} added to cart!`, 'success');
    
    // Redirect to orders page after 2 seconds
    setTimeout(() => {
        window.location.href = 'orders.html';
    }, 2000);
}

// Filter products
function filterProducts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const categoryFilter = document.getElementById('categoryFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;
    
    const filteredProducts = inventory.filter(product => {
        const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                            product.category.toLowerCase().includes(searchTerm) ||
                            product.description.toLowerCase().includes(searchTerm);
        const matchesCategory = !categoryFilter || product.category === categoryFilter;
        const matchesStatus = !statusFilter || product.status === statusFilter;
        
        return matchesSearch && matchesCategory && matchesStatus && product.status === 'Fresh';
    });
    
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';
    
    filteredProducts.forEach(product => {
        const productCard = createProductCard(product);
        grid.appendChild(productCard);
    });
}

// Clear filters
function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('categoryFilter').value = '';
    document.getElementById('statusFilter').value = '';
    loadProductsGrid();
}

// Show notification
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}
</script>

</body>
</html>
