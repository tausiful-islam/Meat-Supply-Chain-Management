<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Historical Data Analytics - MeatChain Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="../assests/Style/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="background-color: #f8f9fa;">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand fw-bold" href="#" id="brandLink"><i class="bi bi-truck me-2"></i>MeatChain Pro</a>
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav me-auto" id="navItems">
      <!-- Navigation items will be loaded based on user role -->
    </ul>
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="login.html"><i class="bi bi-box-arrow-right me-2"></i>Logout</a>
      </li>
    </ul>
  </div>
</nav>

<div class="container-fluid mt-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #28a745, #dc3545);">
        <div class="card-body text-white">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h2 class="mb-1"><i class="bi bi-clock-history me-2"></i>Historical Data Analytics</h2>
              <p class="mb-0 opacity-75">Comprehensive historical analysis of meat production, consumption, and market trends</p>
            </div>
            <div class="col-md-4 text-end">
              <i class="bi bi-graph-up-arrow display-1 opacity-25"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Time Period Selector -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <div class="row align-items-end">
        <div class="col-md-3">
          <label class="form-label fw-semibold">Analysis Period</label>
          <select id="timePeriod" class="form-select">
            <option value="1year">Last 12 Months</option>
            <option value="2years">Last 2 Years</option>
            <option value="5years" selected>Last 5 Years</option>
            <option value="10years">Last 10 Years</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">Product Category</label>
          <select id="productCategory" class="form-select">
            <option value="all" selected>All Products</option>
            <option value="beef">Beef</option>
            <option value="pork">Pork</option>
            <option value="chicken">Chicken</option>
            <option value="lamb">Lamb</option>
            <option value="turkey">Turkey</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-semibold">Region</label>
          <select id="regionFilter" class="form-select">
            <option value="national" selected>National</option>
            <option value="north">Northern Region</option>
            <option value="south">Southern Region</option>
            <option value="east">Eastern Region</option>
            <option value="west">Western Region</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-danger w-100" onclick="updateAnalytics()">
            <i class="bi bi-arrow-clockwise me-2"></i>Update Analysis
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Key Insights Cards -->
  <div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col">
              <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Production Growth</div>
              <div class="h4 mb-0 font-weight-bold text-gray-800" id="productionGrowth">+12.4%</div>
              <div class="text-success small">5-year average</div>
            </div>
            <div class="col-auto">
              <i class="bi bi-graph-up display-4 text-primary"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col">
              <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Price Stability Index</div>
              <div class="h4 mb-0 font-weight-bold text-gray-800" id="priceStability">0.76</div>
              <div class="text-info small">Higher is more stable</div>
            </div>
            <div class="col-auto">
              <i class="bi bi-speedometer2 display-4 text-success"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col">
              <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Consumption Trend</div>
              <div class="h4 mb-0 font-weight-bold text-gray-800" id="consumptionTrend">+8.2%</div>
              <div class="text-success small">Annual increase</div>
            </div>
            <div class="col-auto">
              <i class="bi bi-person-check display-4 text-warning"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col">
              <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Market Volatility</div>
              <div class="h4 mb-0 font-weight-bold text-gray-800" id="marketVolatility">0.34</div>
              <div class="text-warning small">Lower is better</div>
            </div>
            <div class="col-auto">
              <i class="bi bi-activity display-4 text-danger"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Historical Charts -->
  <div class="row g-4">
    <!-- Production Volume Trends -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="bi bi-bar-chart-line me-2"></i>Production Volume Trends</h5>
        </div>
        <div class="card-body">
          <canvas id="productionChart" style="height: 400px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Price Fluctuation Analysis -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-currency-dollar me-2"></i>Historical Price Analysis</h5>
        </div>
        <div class="card-body">
          <canvas id="priceChart" style="height: 400px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Regional Consumption Patterns -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0"><i class="bi bi-geo-alt me-2"></i>Regional Consumption Patterns</h5>
        </div>
        <div class="card-body">
          <canvas id="consumptionChart" style="height: 400px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Feed Conversion & Livestock Data -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-clipboard-data me-2"></i>Feed Conversion Efficiency</h5>
        </div>
        <div class="card-body">
          <canvas id="feedChart" style="height: 400px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Supply vs Demand Analysis -->
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0"><i class="bi bi-bar-chart me-2"></i>Supply vs Demand Analysis</h5>
        </div>
        <div class="card-body">
          <canvas id="supplyDemandChart" style="height: 400px;"></canvas>
        </div>
      </div>
    </div>

    <!-- Market Insights -->
    <div class="col-lg-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0"><i class="bi bi-lightbulb me-2"></i>Key Insights</h5>
        </div>
        <div class="card-body">
          <div id="insights">
            <div class="insight-item mb-3 p-3 bg-light rounded">
              <h6 class="text-primary"><i class="bi bi-arrow-up-circle me-2"></i>Production Peak</h6>
              <p class="mb-0 small">Meat production typically peaks in Q4, with 23% higher output than Q2 average.</p>
            </div>
            
            <div class="insight-item mb-3 p-3 bg-light rounded">
              <h6 class="text-success"><i class="bi bi-calendar-event me-2"></i>Seasonal Trends</h6>
              <p class="mb-0 small">Chicken consumption increases by 18% during summer months, while beef remains stable year-round.</p>
            </div>
            
            <div class="insight-item mb-3 p-3 bg-light rounded">
              <h6 class="text-warning"><i class="bi bi-geo me-2"></i>Regional Variations</h6>
              <p class="mb-0 small">Northern regions show 31% higher per capita meat consumption compared to southern regions.</p>
            </div>
            
            <div class="insight-item mb-3 p-3 bg-light rounded">
              <h6 class="text-danger"><i class="bi bi-exclamation-triangle me-2"></i>Price Volatility</h6>
              <p class="mb-0 small">Lamb prices show highest volatility (CV: 0.45), while chicken prices remain most stable (CV: 0.12).</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Statistics Table -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0"><i class="bi bi-table me-2"></i>Historical Statistics Summary</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Product Type</th>
                  <th>5-Year Avg Production (tons)</th>
                  <th>Avg Price ($/kg)</th>
                  <th>Feed Conversion Ratio</th>
                  <th>Avg Weight at Slaughter (kg)</th>
                  <th>Rearing Period (months)</th>
                  <th>Price Volatility</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Beef</strong></td>
                  <td>580,000</td>
                  <td>$28.50</td>
                  <td>7.2:1</td>
                  <td>520</td>
                  <td>18-24</td>
                  <td class="text-warning">Medium (0.28)</td>
                </tr>
                <tr>
                  <td><strong>Pork</strong></td>
                  <td>420,000</td>
                  <td>$18.20</td>
                  <td>3.5:1</td>
                  <td>110</td>
                  <td>6-8</td>
                  <td class="text-success">Low (0.15)</td>
                </tr>
                <tr>
                  <td><strong>Chicken</strong></td>
                  <td>850,000</td>
                  <td>$12.80</td>
                  <td>1.8:1</td>
                  <td>2.2</td>
                  <td>1.5-2</td>
                  <td class="text-success">Low (0.12)</td>
                </tr>
                <tr>
                  <td><strong>Lamb</strong></td>
                  <td>95,000</td>
                  <td>$35.60</td>
                  <td>5.8:1</td>
                  <td>45</td>
                  <td>12-18</td>
                  <td class="text-danger">High (0.45)</td>
                </tr>
                <tr>
                  <td><strong>Turkey</strong></td>
                  <td>180,000</td>
                  <td>$16.40</td>
                  <td>2.4:1</td>
                  <td>8.5</td>
                  <td>3-5</td>
                  <td class="text-warning">Medium (0.22)</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>

document.addEventListener('DOMContentLoaded', function() {
    checkAuth();
    setupBrandNavigation();
    loadNavigation();
    initializeCharts();
});

function checkAuth() {
    const user = JSON.parse(localStorage.getItem('loggedInUser'));
    if (!user) {
        window.location.href = 'login.html';
        return;
    }
    
    // Only admins can access historical data
    if (user.role !== 'admin') {
        window.location.href = 'customer_dashboard.html';
        return;
    }
}

function setupBrandNavigation() {
    const user = JSON.parse(localStorage.getItem('loggedInUser'));
    const brandLink = document.getElementById('brandLink');
    
    if (user) {
        // User is logged in, redirect to appropriate dashboard
        if (user.role === 'admin') {
            brandLink.href = 'admin_dashboard.html';
        } else if (user.role === 'customer') {
            brandLink.href = 'customer_dashboard.html';
        }
    } else {
        // User is not logged in, redirect to home page
        brandLink.href = '../index.html';
    }
}

function loadNavigation() {
    const user = JSON.parse(localStorage.getItem('loggedInUser'));
    if (!user) return;
    
    const navItems = document.getElementById('navItems');
    if (user.role === 'admin') {
        navItems.innerHTML = `
            <li class="nav-item"><a class="nav-link" href="admin_dashboard.html">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="inventory.html">Inventory</a></li>
            <li class="nav-item"><a class="nav-link" href="suppliers.html">Suppliers</a></li>
            <li class="nav-item"><a class="nav-link" href="orders.html">Orders</a></li>
            <li class="nav-item"><a class="nav-link" href="analytics.html">Analytics</a></li>
            <li class="nav-item"><a class="nav-link" href="reports.html">Reports</a></li>
            <li class="nav-item"><a class="nav-link active" href="historical_data.html">Historical Data</a></li>
        `;
    }
}

function initializeCharts() {
    // Historical production data
    const productionData = {
        labels: ['2019', '2020', '2021', '2022', '2023', '2024'],
        datasets: [
            {
                label: 'Beef (000 tons)',
                data: [520, 545, 565, 580, 595, 610],
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                tension: 0.4
            },
            {
                label: 'Pork (000 tons)',
                data: [380, 395, 410, 420, 425, 430],
                borderColor: '#fd7e14',
                backgroundColor: 'rgba(253, 126, 20, 0.1)',
                tension: 0.4
            },
            {
                label: 'Chicken (000 tons)',
                data: [720, 760, 800, 830, 850, 880],
                borderColor: '#ffc107',
                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                tension: 0.4
            }
        ]
    };

    new Chart(document.getElementById('productionChart'), {
        type: 'line',
        data: productionData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Production (000 tons)' }
                }
            }
        }
    });

    // Historical price data
    const priceData = {
        labels: ['Jan 2020', 'Jul 2020', 'Jan 2021', 'Jul 2021', 'Jan 2022', 'Jul 2022', 'Jan 2023', 'Jul 2023', 'Jan 2024'],
        datasets: [
            {
                label: 'Beef ($/kg)',
                data: [26.20, 27.50, 28.80, 29.10, 30.20, 28.90, 27.80, 28.50, 29.20],
                borderColor: '#dc3545',
                fill: false,
                tension: 0.3
            },
            {
                label: 'Pork ($/kg)',
                data: [16.80, 17.20, 18.50, 18.90, 19.20, 18.60, 17.90, 18.20, 18.80],
                borderColor: '#fd7e14',
                fill: false,
                tension: 0.3
            },
            {
                label: 'Chicken ($/kg)',
                data: [11.50, 12.20, 12.80, 13.10, 13.40, 12.90, 12.60, 12.80, 13.20],
                borderColor: '#ffc107',
                fill: false,
                tension: 0.3
            }
        ]
    };

    new Chart(document.getElementById('priceChart'), {
        type: 'line',
        data: priceData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    title: { display: true, text: 'Price per kg ($)' }
                }
            }
        }
    });

    // Regional consumption data
    const consumptionData = {
        labels: ['Northern', 'Southern', 'Eastern', 'Western', 'Central'],
        datasets: [{
            label: 'Per Capita Consumption (kg/year)',
            data: [52.4, 38.2, 45.8, 41.6, 48.9],
            backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1']
        }]
    };

    new Chart(document.getElementById('consumptionChart'), {
        type: 'bar',
        data: consumptionData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Consumption (kg/year)' }
                }
            }
        }
    });

    // Feed conversion efficiency
    const feedData = {
        labels: ['Chicken', 'Pork', 'Turkey', 'Lamb', 'Beef'],
        datasets: [{
            label: 'Feed Conversion Ratio',
            data: [1.8, 3.5, 2.4, 5.8, 7.2],
            backgroundColor: ['#28a745', '#17a2b8', '#6c757d', '#ffc107', '#dc3545']
        }]
    };

    new Chart(document.getElementById('feedChart'), {
        type: 'bar',
        data: feedData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Feed:Meat Ratio' }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });

    // Supply vs Demand
    const supplyDemandData = {
        labels: ['2019', '2020', '2021', '2022', '2023', '2024'],
        datasets: [
            {
                label: 'Supply (000 tons)',
                data: [1620, 1700, 1775, 1830, 1870, 1920],
                backgroundColor: 'rgba(40, 167, 69, 0.7)',
                borderColor: '#28a745',
                borderWidth: 2
            },
            {
                label: 'Demand (000 tons)',
                data: [1580, 1650, 1720, 1790, 1850, 1900],
                backgroundColor: 'rgba(220, 53, 69, 0.7)',
                borderColor: '#dc3545',
                borderWidth: 2
            }
        ]
    };

    new Chart(document.getElementById('supplyDemandChart'), {
        type: 'bar',
        data: supplyDemandData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Volume (000 tons)' }
                }
            }
        }
    });
}

function updateAnalytics() {
    showNotification('Updating analytics based on selected parameters...', 'info');
    
    // Simulate data refresh
    setTimeout(() => {
        showNotification('Analytics updated successfully!', 'success');
        // Here you would typically fetch new data and update charts
    }, 1500);
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 5000);
}
</script>
</body>
</html>
